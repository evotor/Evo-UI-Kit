<ng-container
    *ngIf="{
        calendar: calendar$ | async,
        startDate: startDate$ | async,
        endDate: endDate$ | async,
        calendarState: calendarState$ | async,
        isRangeMode: isRangeMode$ | async,
        isTimeInputEnabled: isTimeInputEnabled$ | async
    } as asyncData"
>
    <div class="calendar">
        <evo-calendar-section-header
            [calendarState]="asyncData.calendarState"
            (back)="onBackClick($event)"
            (next)="onNextClick($event)"
            (calendarStateChange)="onCalendarStateChange($event)"
        ></evo-calendar-section-header>

        <ng-container [ngSwitch]="asyncData.calendarState">
            <evo-calendar-section-days
                *ngSwitchCase="CalendarState.DAYS"
                (dateChange)="onDateChange($event)"
            ></evo-calendar-section-days>
            <evo-calendar-section-months
                *ngSwitchCase="CalendarState.MONTHS"
                (dateChange)="onMonthChange($event)"
            ></evo-calendar-section-months>
            <evo-calendar-section-years
                *ngSwitchCase="CalendarState.YEARS"
                (dateChange)="onYearChange($event)"
            ></evo-calendar-section-years>
        </ng-container>

        <div *ngIf="hasTime" class="calendar__time-wrapper">
            <ng-container *ngIf="asyncData.isRangeMode === true">
                <evo-calendar-input-time
                    class="calendar__time"
                    [class]="{calendar__time_hidden: asyncData.calendarState !== CalendarState.DAYS}"
                    [time]="asyncData.startDate"
                    [label]="'Начало периода' + (asyncData.isTimeInputEnabled ? ' (' + (asyncData.startDate | date : DATE_COMPOSE_FORMAT) + ')' : '')"
                    [disabled]="!asyncData.isTimeInputEnabled"
                    (timeChange)="onTimeChange($event, 'start')"
                ></evo-calendar-input-time>
                <evo-calendar-input-time
                    class="calendar__time"
                    [class]="{calendar__time_hidden: asyncData.calendarState !== CalendarState.DAYS}"
                    [time]="asyncData.endDate"
                    [label]="'Конец периода' + (asyncData.isTimeInputEnabled ? ' (' + (asyncData.endDate | date : DATE_COMPOSE_FORMAT) + ')' : '')"
                    [disabled]="!asyncData.isTimeInputEnabled"
                    (timeChange)="onTimeChange($event, 'end')"
                ></evo-calendar-input-time>
            </ng-container>
            <ng-container *ngIf="asyncData.isRangeMode === false">
                <evo-calendar-input-time
                    class="calendar__time"
                    [class]="{calendar__time_hidden: asyncData.calendarState !== CalendarState.DAYS}"
                    [time]="asyncData.startDate"
                    (timeChange)="onTimeChange($event)"
                ></evo-calendar-input-time>
            </ng-container>
            <button
                evoButton
                theme="rounded-solid"
                size="small"
                color="success"
                class="calendar__button"
                (click)="onApplyClick()"
            >
                Применить
            </button>
        </div>
    </div>
</ng-container>
